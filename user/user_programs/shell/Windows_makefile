USERLIB=..\..\user_tools

ASFLAGSOBJ= -O32 -f elf
NASM = nasmw
 
CFLAGS= -std=c99 -Werror -Wall -O -ffreestanding -fleading-underscore -nostdlib -nostdinc -fno-builtin -I'$(USERLIB)/src/include'
CC= i586-elf-gcc
 
LDFLAGS= -T $(USERLIB)\user.ld -Map program.map -nostdinc -s --gc-sections --whole-archive
LD= i586-elf-ld
 
all: SHELL.ELF
	@cecho .{09}Cleaning up...{#}{\n}
	@del *.o
 
SHELL.ELF: 	program.o 
	@cecho {09}Linking program {#}{\t}==^> $@...
	@$(LD) $(LDFLAGS) -l:$(USERLIB)\userlib.lib $+ -o $@
	@cecho .{0a}done{#}{\n}
 
program.o: program.c 
	@cecho {09}Compiling {#}{\t}==^> $<...
	@$(CC) -c $(CFLAGS) $< -o $@
	@cecho .{0a}done{#}{\n}
 
%.o: %.asm
	$(NASM) $(ASFLAGSOBJ) $< -o $@ 
 
#    $<  Erste Abh�ngigkeit
#    $+  Liste aller Abh�ngigkeiten 
#    $@  Name des Targets
